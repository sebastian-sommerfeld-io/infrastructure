= Server: proxmox

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

[cols="1,3", options="header"]
|===
|Hostname |prometheus
|FQDN |prometheus.fritz.box
|User (Password) |root (admin)
|===

== Requirements Overview
. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.
. At vero eos et accusam et justo duo dolores et ea rebum.
. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.
. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.
. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

This machine cannot conform to all requirements from the xref:homelab/installation-guide.adoc[]. Since the Proxmox Wizard asks to set a password for its default user "root", it is not (easily) possible to run proxmox with a user other than root.

== Quality Goals
. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.
. At vero eos et accusam et justo duo dolores et ea rebum.
. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.
. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.
. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

As mentioned in the xref:homelab/installation-guide.adoc[] this setup is done (partially) by hand and not fully automated. This page describes the setup process in order to re-install the machine in the same way if needed.

== Install

. Download Proxmox installation iso image from https://www.proxmox.com/en/downloads/item/proxmox-ve-7-1-iso-installer
. Create bootable USB stick using the application "Startup Disk Creator" (shipped with Ubuntu) or something else like Etcher
. Install the OS on the machine (Setup Wizard Option "Install Proxmox VE")
.. Step 1: Target Disk
... HDD Layout = unchanged
.. Step 2: Location and Time Zone
... Country = `Germany`
... Timezone = `Europe/Berlin`
... Keyboard = `German`
.. Step 3: Administration Password and Email Address
... Password = `admin` (Default Username is `root`)
... Email = sebastian@sommerfeld.io
.. Step 4: Network Configuration
... Management Interface = `wlo1` (select from Dropdown)
... FQDN = `proxmox.fritz.box`
... IP = `192.168.178.200` -> Free IP from my local network
... Gateway = `192.168.178.1`
... DNS = `127.0.0.1`

Once the OS is installed and configured, perform the following steps:

. Enable SSH on machine "proxmox"
.. TODO on server
. Test connections
.. Test Management Console via browser from normal workstation (https://proxmox.fritz.box:8006)
.. Test SSH connection from normal workstation
... Connect with SSH keys
. Install tools on machine "proxmox"
.. Connect via SSH from workstation to machine "proxmox"
... Adjust bash prompt ...
... Install Docker ???
... Start node_exporter
... Start cAdvisor

NOTE: Proxmox is fully manageable via SSH or Web Interface (open https://proxmox.fritz.box:8006 and accept the self signed certificate).

== Usage
How to set up new VMs ... (UI and Terraform) -> Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

== Building Block View / Whitebox Overall System
[plantuml, rendered-plantuml-image, svg]
----
@startuml

skinparam linetype ortho
skinparam monochrome false
skinparam componentStyle uml2
skinparam backgroundColor transparent
skinparam ArrowColor black
skinparam CollectionsBorderColor black
skinparam ComponentBorderColor black
skinparam ComponentBackgroundColor #FEFECE
skinparam NoteBorderColor Grey
skinparam NoteBackgroundColor #fdfdfd
skinparam defaultTextAlignment center
skinparam activity {
  FontName Ubuntu
}

component proxmox <<Lenovo>>
component proxmox_bridge as "proxmox-bridge" <<RasPi>>
cloud wifi_network
component workstation as "some\nworkstation"

proxmox_bridge -> proxmox: cable
wifi_network ~> proxmox_bridge
workstation ~> wifi_network

@enduml
----

. Running Proxmox via Wifi means that VMs cannot access the outside world because most access Points drop their packages. The VM comes with their own Mac and IP which are unknown to the access point.
.. From link:https://pve.proxmox.com/wiki/WLAN[Proxmox Docs]: Avoid using WLAN if possible, it has several technical limitations making it not really suitable as single interface of a hyper-visor like PVE. Wi-Fi adapters can only be used as Linux bridge interface through workarounds, as most Access Points (APs) will reject frames that have a source address that didn't authenticate with the AP.
. To avoid this behavior the xref:homelab/physical/proxmox-bridge/index.adoc[] accepts WLAN connections and bridges them to the proxmox server via cable.

=== Services
[cols="3,1,2", options="header"]
|===
|Service |URL |User (Password)
|Node Exporter |http://proxmox.fritz.box:9100 |-
|cAdvisor |http://proxmox.fritz.box:9110 |-
|Portainer |http://proxmox.fritz.box:9990 |admin (admin)
|Proxmox Web Console |http://proxmox.fritz.box:8006 |root (admin)
|===

== Risks and Technical Debts
Scale for Probability and Impact: Low, Medium and High

[cols="^1,2,7a,1,1,4a", options="header"]
|===
|# |Title |Description |Probability |Impact |Response
|{counter:usage} |none |none |none |none |none
|===
