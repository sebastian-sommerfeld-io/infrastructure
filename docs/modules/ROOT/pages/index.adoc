 Startpage
Sebastian Sommerfeld <sebastian@sommerfeld.io>
:project-name: infrastructure
:url-project: https://github.com/sebastian-sommerfeld-io/{project-name}

Infrastructure repository with configs and docs for my local workstations, my homelab with Proxmox and RasPi nodes and my public website hosted in the cloud.

[cols="1,4", options="header"]
|===
|What |Where to find
|Repository |{url-project}
|Documentation |https://docs.sommerfeld.io/{project-name}/main
|===

[IMPORTANT]
====
*Todos*

. Merge and delete repo kobol-config
. ADR: xref:ADRs:architecture-decision-records/kobol-vs-pegasus.adoc[]
. ADR: xref:ADRs:architecture-decision-records/chef-vs-ansible.adoc[]
. Do I really need the separate prometheus-grafana repo? Can I merge the repo into this project? Or is this a service on its own? If so, create a Docker image and deploy via terraform.
.. Can terraform deploy containers to remote raspi nodes? Withoput kubernetes etc?!
. Find Docker-based alternative to cron -> Rundeck or something else?
. Make Vagrantbox idempotent -> handle .gitignore differently
====

== Requirements Overview
. Centrally manage all my infrastructure components.
.. My physical workstations and all link:/playgrounds-docs/main[non-playground] Vagrantboxes
.. My homelab (physical and virtual)
.. My public website (classic web hosting and link:https://cloud.digitalocean.com[DigitalOcean])
. Every single setup for every component with as little manual interaction as possible.
. Manage assets which are common to all projects in one place.
.. Allow other projects, to load these assets into their respective repo (each project takes care of this on its own)

== Quality Goals
. Lint everything inside this repo
. Encapsulate as much as possible inside Docker Containers and/or Vagrantboxes to ensure (broken) updates can easily be rolled back and the setup is portable in case I have to reset my workstation or have to switch to another workstation.
.. Add or update packages without any risk -> avoid having to repair broken installations (dumping the broken setup and reverting to a working one is preferred).
.. Instead of using e.g. `apt-get install`, use Docker Contaioners and create a Symlink in `/usr/bin` to a wrapper-script which delegates commands to a Docker contaner.

== Building Block View / Whitebox Overall System
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ... summary on how my remote and on-prem artifacts are updated ... docs.sommefeld.io = digitalocean = terraform ...

=== Public Sites hosted on the Internet
Public sites are divided into two parts. The first part is hosted traditionally by a classic hosting provider and the second part is hosted in the cloud (xref:ADRs:architecture-decision-records/cloud-provider.adoc[by default at Digital Ocean]).

[plantuml, rendered-plantuml-image, svg]
----
@startuml

skinparam linetype ortho
skinparam monochrome false
skinparam componentStyle uml2
skinparam backgroundColor transparent
skinparam ArrowColor black
skinparam FrameBackgroundColor #fff
skinparam CollectionsBackgroundColor #fefece
skinparam CollectionsBorderColor black
skinparam ComponentBorderColor black
skinparam ComponentBackgroundColor #fefece
skinparam RectangleBorderColor black
skinparam RectangleBackgroundColor #fefece
skinparam QueueBorderColor black
skinparam NoteBorderColor Grey
skinparam NoteBackgroundColor #fdfdfd
skinparam defaultTextAlignment center
skinparam activity {
  FontName Ubuntu
}

rectangle DigitalOcean {
    component docs as "docs.sommerfeld.io" <<app>>
}

rectangle ClassicHosting {
    component www as "www.sommerfeld.io" <<static-site>>
}

rectangle DockerHub {
    node docs_image as "sommerfeldio/docs-website" <<latest or stable>>
}

control tf as "Terraform"
control FTP

docs_image ~up~> docs
docs_image -right-> tf
tf -up-> DigitalOcean

FTP -up-> ClassicHosting

@enduml
----

For information on the DigitalOcean setup take a look at the xref:cloud.adoc[] page.

=== On-Premise Homelab
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ... text plus diagram

== Usage
=== Linters
The link:https://github.com/sebastian-sommerfeld-io/infrastructure[Infrastructure Repository] contains ready-to-use linter definitions which other projects can download and use (see link:https://github.com/sebastian-sommerfeld-io/infrastructure/blob/main/lint.sh[lint.sh]).

==== directory-validator
The link:https://github.com/goerwin/directory-validator[directory-validator] checks if all mandatory files and folders are present. Folders cannot be empty. For "empty" folders, add a .gitkeep file and explain why this folder is empty (= empty in the remote repo). Empty .gitkeep files normally are placeholders, until the directory is populated with the actual content.

== Risks and Technical Debts
Scale for Probability and Impact: Low, Medium and High

[cols="^1,2,5a,1,1,5a", options="header"]
|===
|# |Title |Description |Probability |Impact |Response
|{counter:usage} |- |- |- |- |-
|===
