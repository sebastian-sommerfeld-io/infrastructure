= Cloud Infrastructure
Sebastian Sommerfeld <sebastian@sommerfeld.io>

++++
<div style="float: right;">
    <div style="margin: 0 0 1em 2em">
        <a href="https://www.digitalocean.com/?refcode=4fd3122a67c0&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.digitaloceanspaces.com/WWW/Badge%202.svg" alt="DigitalOcean Referral Badge" /></a>
        <!--<a href="https://www.digitalocean.com/?refcode=4fd3122a67c0&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.digitaloceanspaces.com/WWW/Badge%203.svg" alt="DigitalOcean Referral Badge" /></a>-->
        <!--<a href="https://www.digitalocean.com/?refcode=4fd3122a67c0&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge%201.svg" alt="DigitalOcean Referral Badge" /></a>-->
    </div>
    <!--<div style="margin: 0 0 1em 2em">
        <a href="https://www.linode.com"><img src="https://www.linode.com/wp-content/uploads/2021/01/Linode-Logo-Black.svg" alt="Lindode Badge" /></a>
    </div>-->
    <div style="margin: 0 0 1em 2em">
        <a href="https://www.terraform.io"><img style="width: 200px;" src="https://www.datocms-assets.com/2885/1620155113-brandhcterraformprimaryattributedcolor.svg" alt="Terraform Badge" /></a>
    </div>
</div>
++++

This is the latest and up-to-date Terraform configuration for all *.sommerfeld.io services running in the cloud (meaning every service/subdomain outside www.sommerfeld.io). The cloud provider of choice is DigitalOcean although some services might run at Linode.

For further information on the decision process take a look at xref:ADRs:architecture-decision-records/cloud-provider.adoc[].

For information when to use which DigitalOcean object / platform, take a look at the "xref:GUIDELINES:index.adoc[]" page.

== Building Block View / Whitebox Overall System
[plantuml, rendered-plantuml-image, svg]
----
@startuml

skinparam linetype ortho
skinparam monochrome false
skinparam componentStyle uml2
skinparam backgroundColor transparent
skinparam ArrowColor black
skinparam FrameBackgroundColor #fff
skinparam CollectionsBackgroundColor #fefece
skinparam CollectionsBorderColor black
skinparam ComponentBorderColor black
skinparam ComponentBackgroundColor #fefece
skinparam RectangleBorderColor black
skinparam RectangleBackgroundColor #fefece
skinparam QueueBorderColor black
skinparam NoteBorderColor Grey
skinparam NoteBackgroundColor #fdfdfd
skinparam defaultTextAlignment center
skinparam activity {
  FontName Ubuntu
}

rectangle allinkl as "all-inkl" <<classic hosting>> {
    file www <<Subdomain CNAME>>
    file linode <<Subdomain>>
    file sio as "sommerfeld.io" <<Domain>>
    collections dns as "DNS settings"
}

rectangle DigitalOcean <<cloud provider>> {
    file docs <<Subdomain>>
}

rectangle Linode <<cloud provider>> {
    label nothing as "nothing\nso far"
}

www -right-> sio
linode -up-> sio
docs -right-> sio
dns ~down~> linode
dns ~right~> docs

Linode -left-> linode

@enduml
----

The domain provider needs some DNS settings to ensure all *.sommerfeld.io subdomains work. Each subdomain need the same DNS settings to make sure the services deployed at DigitalOcean are reachable through <subdomain>.sommerfeld.io and not only through the <random-subdomain>.ondigitalocean.app. For information on "How to Manage Domains in App Platform" take a look DigitalOcean docs, especially the "link:https://docs.digitalocean.com/products/app-platform/how-to/manage-domains[Option 2: Using a CNAME Pointer]" section.
[cols="2,1,5",options="header"]
|===
|(Sub-) Domain |Type |Target
|docs |CNAME |<random-subdomain>.ondigitalocean.app.
|===

Same would be necessary for services running as *.linode.sommerfeld.io.

.This configuration is currently running across all service providers.
image:ROOT:generated/terraform/terraform-sommerfeld-io.png[]

include::ROOT:partial$generated/terraform/terraform-sommerfeld-io.adoc[]

== Further Information
* For docs on DigitalOcean with Terraform see https://docs.digitalocean.com/reference/terraform and https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs.
* Also see the link:https://www.digitalocean.com/community/conceptual_articles/infrastructure-as-code-explained[Tutorial Series: How To Manage Infrastructure with Terraform] on the DigitalOcean website.
