= Cloud Infrastructure
Sebastian Sommerfeld <sebastian@sommerfeld.io>

++++
<div style="float: right;">
    <div style="margin: 0 0 1em 2em">
        <a href="https://www.terraform.io"><img style="width: 200px;" src="https://www.datocms-assets.com/2885/1620155113-brandhcterraformprimaryattributedcolor.svg" alt="Terraform Badge" /></a>
    </div>
    <div style="margin: 0 0 1em 2em">
        <a href="https://www.digitalocean.com/?refcode=4fd3122a67c0&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.digitaloceanspaces.com/WWW/Badge%202.svg" alt="DigitalOcean Referral Badge" /></a>
        <!--<a href="https://www.digitalocean.com/?refcode=4fd3122a67c0&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.digitaloceanspaces.com/WWW/Badge%203.svg" alt="DigitalOcean Referral Badge" /></a>-->
        <!--<a href="https://www.digitalocean.com/?refcode=4fd3122a67c0&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge%201.svg" alt="DigitalOcean Referral Badge" /></a>-->
    </div>
    <!--<div style="margin: 0 0 1em 2em">
        <a href="https://www.linode.com"><img src="https://www.linode.com/wp-content/uploads/2021/01/Linode-Logo-Black.svg" alt="Lindode Badge" /></a>
    </div>-->
</div>
++++

This is the latest and up-to-date Terraform configuration for all *.sommerfeld.io services running in the cloud (meaning every service/subdomain outside www.sommerfeld.io). The cloud provider of choice is DigitalOcean although some services might run at Linode.

For further information on the decision process take a look at xref:ADRs:architecture-decision-records/cloud-provider.adoc[].

For information when to use which DigitalOcean object / platform, take a look at the "xref:GUIDELINES:index.adoc[]" page.

== Building Block View / Whitebox Overall System
The domain provider needs some DNS settings to ensure the name resoulution for all subdomains for sommerfeld.io point to the right cloud provider. Each cloud provider has its own subdomain and for which the proper NS recores are set. The NS records need to be added under the DNS zone of the main (sub-) domain. This way name resolution for further subdomains is delegated to the respective cloud provider.

These basic subdomains are configured for the domain "sommerfeld.io" through the link:https://kas.all-inkl.com[domain providers management console]. This initial setup takes place once for each subdomain.
[cols="1,1,3",options="header"]
|===
|Domain |Provider |Target
|apps.sommerfeld.io |tbd |Reserved for different cloud (similar to `cloud`)
|cloud.sommerfeld.io |DigitalOcean |Used for DNS settings -> NS records point to http://ns1.digitalocean.com, http://ns2.digitalocean.com and http://ns3.digitalocean.com.
|digitalocean.sommerfeld.io |DigitalOcean |DNS config is exactly the same config as `cloud` -> used for temporary and testing purposes
|linode.sommerfeld.io |Linode |Reserved for Linode (similar to `cloud`) - _no running service yet_
|===

=== Services
This configuration is currently running across all service providers (as set up by Terraform).

image:ROOT:generated/terraform/terraform-sommerfeld-io.png[]

include::ROOT:partial$generated/terraform/terraform-sommerfeld-io.adoc[]

== Architecture Decisions
. xref:ADRs:architecture-decision-records/cloud-provider.adoc[]

== Risks and Technical Debts
Scale for Probability and Impact: Low, Medium and High

[cols="1,3,5,1,1,1", options="header"]
|===
|# |Title |Description |Probability |Impact |Response
|{counter:usage} |none |none |none |none |none ||none
|===

== Further Information
* For docs on DigitalOcean with Terraform see https://docs.digitalocean.com/reference/terraform and https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs.
* Also see the link:https://www.digitalocean.com/community/conceptual_articles/infrastructure-as-code-explained[Tutorial Series: How To Manage Infrastructure with Terraform] on the DigitalOcean website.
