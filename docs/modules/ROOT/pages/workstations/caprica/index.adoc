= Server: caprica
Sebastian Sommerfeld <sebastian@sommerfeld.io>
:hostname: caprica
include::ROOT:partial$generated/ansible/caprica-vars.adoc[]

include::ROOT:partial$badges/homelab.adoc[]

Setup, configuration and documentation for my local toolserver which also acts as a testing- and staging-ground for my container images. The Setup follows an infrastructure as code approach. This machines takes care of Docker images and Vagrantboxes and handles some automation tasks.

[cols="1,3a", options="header"]
|===
|Key |Value
|Hostname |{hostname} (FQDN = {hostname}.fritz.box)
|OS |Ubuntu Server 22.04
|User (Password) |{user} ({pass})
|Hardware |Lenovo Think Centre (Core i5, 126GB RAM)
|===


== Requirements Overview
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ...

== Quality Goals
. The whole setup, all my Vagrantboxes and all Docker images is Infrastructure as Code.
. Software installations through the classic package managers like `apt` should be avoided. As much as possible should run inside docker containers. This is true for the host machine as well as Vagrantboxes.

== Building Block View / Whitebox Overall System
=== Services
The following services are up and running when the machine is started.

[cols="1,1,3", options="header"]
|===
|Service |URL |User (Password)
|Node Exporter |http://localhost:9100 |-
|cAdvisor |http://localhost:9110 |-
|Portainer |http://localhost:9990 |admin (see `PATH_TO/portainer.passwd`)
|===


== Install
=== Prepare bootable USB stick and install Ubuntu
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ...

=== Provision System
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ...

== Usage
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ...

=== Run Services
Services are defined in a docker-compose.yml file. The compose files are grouped into folders representing their respective set of usecases.

Controlling these services is done from host `kobol`. Deploying to the remote node `caprica` is done using DOCKER_HOST environment variable to set up the target engine. link:https://www.docker.com/blog/how-to-deploy-on-remote-docker-hosts-with-docker-compose[Docker Contexts] is another possibility but not used because the test environment `caprica-test` is using DHCP instead of a static IP.

CAUTION: todo ... how do I run the deployment? Which script? Something from src/main/workstations/caprica ... how do I run the test script?

==== Automated Tests
Run `src/test/workstations/caprica/run-tests.sh` to startup a Vagrantbox, run all Ansible playbooks for `caprica` inside the Vagrantbox `caprica-test` and run tests to check the installation. Inside `caprica-test` the docker services are tested as well.

== Architecture Decisions
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

CAUTION: todo ... (Ubuntu with Vagrant vs Proxmox ???) -> Decision = Don't use Vagrant at all and run containers directly (because Jenkins should be able to start/stop Vagrantboxes)?!

== Risks and Technical Debts
Scale for Probability and Impact: Low, Medium and High

[cols="1,3,5,1,1,1", options="header"]
|===
|# |Title |Description |Probability |Impact |Response
|{counter:usage} |none |none |none |none |none ||none
|===
