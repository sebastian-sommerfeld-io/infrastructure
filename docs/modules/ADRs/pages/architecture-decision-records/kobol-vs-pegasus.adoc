= Kobol vs. Pegasus
Sebastian Sommerfeld <sebastian@sommerfeld.io>

// https://docs.google.com/spreadsheets/d/13trHjYR6NSg2-XDDzEx_Wt-AH2becUVeto5abweKdF0/edit

*The decision at hand* is whether to run all development tools insde a Vagrantbox or directly on my local workstation.

====
Status: Open +
Date of decision: 2022-xx-xx
====

== Requirements Overview
. Setup with minimal manual interactions and minimal development tools installed directly onto my workstation.
. Encapsulated as much as possible inside Docker Containers and/or Vagrantboxes to ensure (broken) updates can easily be rolled back and the setup is portable in case I have to reset my workstation or have to switch to another workstation.
.. Add or update packages without any risk -> avoid having to repair broken installations (dumping the broken setup and reverting to a working one is preferred).
.. Instead of using apt-get install, use Docker and create a Symlink in /usr/bin to a wrapper-script which delegates commands to a Docker contaner.

=== Quality Goals
. The whole setup follows is Infrastructure as Code.
. As much as possible runs in Containers.

== Decision
Lorem ipsum dolor ... The setup of choice is ...

=== Todos resulting from architecture decision
. Remove Repo "kobol-vagrant"
. Merge Repo "kobol-scripts" into Repo "kobol-vagrant"
. Reset kobol machine from scratch

=== Todos resulting from architecture decision
. Make VM idempotent
.. Remove dependencies other than synced folders (ship with dedicated .gitignore file)

IMPORTANT: Depending on decision, only one todo block remains.

[cols="1,1,1,1", options="header"]
|===
2+|Run everything directly on physical machine "kobol" 2+|Encapsulate everything inside Vagrantbox "pegasus"
|*Pro* |*Con* |*Pro* |*Con*
|Terraform can startup Docker Containers and Vagrantboxes. |- |- |Terraform can only start Docker Containers. No connection to Vagrant on host.
|- |Docker image leftovers remain on host machine. |Docker image leftovers are gone when VM is removed. |-
|- |Broken configs must be repaired, simple rollback more complicated (when not encapsuled in Docker). |No need to repair broken configs. Just revert to an older version. |-
|No need to Sync SSH Keys into VM (this is not really a pain either). |- |- |SSH Keys must be synced into VM (this is not really a pain either).
|No (additional) issues with network / SSH when connection to other nodes on the network. |- |- |Some connections to nodes on the network don't work as expected (especially from Docker Container inside Vagrantbox).
|- |Setup is not easily portable. Scripts can be used on other machines but one might have to update the scripts according to the new machine. |- |Dependencies must be met (`~/.ssh`, `~/.tmp`, `~/.work` directories, `.gitconfig file`) -> so the setup is not portable without adjustments.
|No difference between IntelliJ terminal and "regular" terminal. |- |- |Some GUI tools are still running on kobol directly (IntelliJ, Postman). IntelliJ terminal differs from terminal inside Vagrantbox.
|No need to SSH into a Vagrantbox for terminal commands (this is not really a pain either). |- |- |Need to SSH into a Vagrantbox for terminal commands (this is not really a pain either).
|- |Resources and services not strictly isolated from one another. Bad crashes can take down the host system as well. In a worst case scenario the host machine must be cleaned up and repaired manually. |Stricter isolation of resources and services for development tools. Harder to crash whole system. In case of a bad crash, VM can be reset from scratch. |-
|- |Running updated of tools, which are not wrapped in a Docker Container, comes with a higher risk and higher expense in case of rollback. |Running any update comes without any risk because reverting to a working setup can be done easily. This becomes even easier when every update has a dedicated git branch. |-
|- |Staging ground (dedicated VM?) for new tools needed to avoid leftovers on the host machine. |No staging ground to test new tools needed. The VM can be trashed and setup from scratch without these tools leafing no trace of any PoC. |-
|No port forwarding needed |- |- |Dedicated port-forwarding needed. In case more ports than the currently forwarded ports are needed, a VM restart is necessary.
|===
